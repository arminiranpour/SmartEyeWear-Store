@{
    ViewData["Title"] = "اسکن چهره";
}

<h2>📸 اسکن چهره</h2>

<video id="video" width="400" autoplay></video>
<br />
<button id="snap" class="btn btn-primary mt-2">گرفتن عکس</button>
<br />
<br />
<canvas id="canvas" width="400"></canvas>
<br />
<form id="photoForm" method="post" enctype="multipart/form-data" asp-action="SavePhoto">
    <input type="hidden" id="imageData" name="imageData" />
    <button type="submit" class="btn btn-success mt-2">ارسال عکس</button>
</form>

@section Scripts {
    <script>
        var video = document.getElementById('video');
        var canvas = document.getElementById('canvas');
        var snap = document.getElementById("snap");
        var imageData = document.getElementById("imageData");
        var context = canvas.getContext('2d');

        // فعال کردن دوربین
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                video.srcObject = stream;
                video.play();
            })
            .catch(function (err) {
                console.log("خطا: " + err);
            });

        // گرفتن عکس
        snap.addEventListener("click", function () {
            context.drawImage(video, 0, 0, 400, 300);
            var dataUrl = canvas.toDataURL("image/png");
            imageData.value = dataUrl;
        });
    </script>
}
